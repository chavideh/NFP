@using MudBlazor
@using PCH.NFP.Shared.Models

@inject ProductService ProductService
@inject ISnackbar Snackbar

<MudDialog MaxWidth="MaxWidth.Small" FullWidth="true" CloseOnEscapeKey="true" CloseOnOutsideClick="false">
    <TitleContent>ویرایش محصول</TitleContent>
    <DialogContent>
        <MudForm Model="@Product" @ref="@form" ValidationDelay="0">

            <MudTextField @bind-Value="Product.Code"
                          For="@(() => Product.Code)"
                          Immediate="true"
                          Label="کد محصول"
                          Required="true" />

            <MudTextField @bind-Value="Product.Title"
                          For="@(() => Product.Title)"
                          Immediate="true"
                          Required="true"
                          Label="عنوان محصول" />


            <MudTextField @bind-Value="Product.IranCode"
                          For="@(() => Product.IranCode)"
                          Immediate="true"
                          Label="ایران کد" />

            <MudTextField @bind-Value="Product.SepidarCode"
                          For="@(() => Product.SepidarCode)"
                          Immediate="true"
                          Label="کد سپیدار" />


            <MudTextField @bind-Value="Product.Description"
                          For="@(() => Product.Description)"
                          Lines="4"
                          Immediate="true"
                          Label="توضیحات" />


        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text" Color="Color.Secondary" OnClick="Cancel">انصراف</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="OnValidSubmit" >ذخیره</MudButton>
    </DialogActions>

</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter] public ProductDto Product { get; set; } = new();

    private MudForm form = default!;

    private async Task OnValidSubmit()
    {
        var updatedProduct = Product;

        var response = await ProductService.UpdateProductAsync(updatedProduct);

        if (response.Success)
        {
                Snackbar.Add(response.Message, Severity.Success);
                MudDialog.Close(DialogResult.Ok(Product));
        }

           Snackbar.Add(response.Message, Severity.Warning);

 
    }

    void Cancel()
    {
        MudDialog.Cancel();
    }
}
